apiVersion: "authentication.istio.io/v1alpha1"
kind: "Policy"
metadata:
  name: frontend-jwt-validation
spec:
  targets:
  - name: frontend
  origins:
  - jwt:
      issuer: "http://voravit.example.com:8080/auth/realms/quickstart"
      jwksUri: "https://gitlab.com/workshop6/service-mesh/raw/jwt/keycloak/jwks.json"
      #jwks: "{\"keys\":[{\"kid\":\"FJ86GcF3jTbNLOco4NvZkUCIUmfYCqoqtOQeMfbhNlE\",\"kty\":\"RSA\",\"alg\":\"RS256\",\"use\":\"sig\",\"n\":\"q1awrk7QK24Gmcy9Yb4dMbS-ZnO6NDaj1Z2F5C74HMIgtwYyxsNbRhBqCWlw7kmkZZaG5udyQYY8d91Db_uc_1DBuJMrQVsYXjVSpy-hoKpTWmzGhXzyzwhfJAICp7Iu_TTKPp-ip0mPGHlJnnP6dr4ztjY7EgFXFhEDFYSd9S8\",\"e\":\"AQAB\"}]}"
  principalBinding: USE_ORIGIN
  # Get jwks from Keycloak/RHSSO
  # curl http://localhost:8080/auth/realms/{Realm}/protocol/openid-connect/certs
  # Login to Keycloak/RHSSO
  # curl --location --request POST 'http://localhost:8080/auth/realms/${Realm}/protocol/openid-connect/token' --header 'Content-Type: application/x-www-form-urlencoded' --data-urlencode 'username=operator' --data-urlencode 'password=password' --data-urlencode 'client_id=curl' --data-urlencode 'grant_type=password'
  